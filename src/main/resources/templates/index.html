<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      lang="en">
    <head>
        <meta charset="utf-8" />
        <title th:text="${brandingTitle}">Meta64</title>
        <meta name="description"
              th:content="${brandingMetaContent}" />
        <meta name="keywords"
              content="jcr" />
        <meta name="viewport"
              content="width=device-width, initial-scale=1" />
        <!-- Place favicon.ico in the `app/` directory -->
        <!-- Chrome for Android theme color -->
        <meta name="theme-color"
              content="#2E3AA1" />
        <!-- Web Application Manifest -->
        <link rel="manifest"
              href="manifest.json" />
        <!-- Tile color for Win8 -->
        <meta name="msapplication-TileColor"
              content="#3372DF" />
        <!-- Add to homescreen for Chrome on Android -->
        <meta name="mobile-web-app-capable"
              content="yes" />
        <meta name="application-name"
              content="meta64.com" />
        <link rel="icon"
              sizes="192x192"
              href="images/touch/chrome-touch-icon-192x192.png" />
        <!-- Add to homescreen for Safari on iOS -->
        <meta name="apple-mobile-web-app-capable"
              content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style"
              content="black" />
        <meta name="apple-mobile-web-app-title"
              content="Meta64" />
        <link rel="apple-touch-icon"
              href="images/touch/apple-touch-icon.png" />
        <!-- Tile icon for Win8 (144x144) -->
        <meta name="msapplication-TileImage"
              content="images/touch/ms-touch-icon-144x144-precomposed.png" />
        <!-- build:js bower_components/webcomponentsjs/webcomponents-lite.min.js -->
        <script src="/bower_components/webcomponentsjs/webcomponents-lite.js"></script>
        <link rel="import"
              href="/bower_components/polymer/polymer.html" />
        <link rel="import"
              href="/bower_components/paper-styles/typography.html" />
        <!-- Iron elements -->
        <link rel="import"
              href="/bower_components/iron-flex-layout/classes/iron-flex-layout.html" />
        <link rel="import"
              href="/bower_components/iron-icons/iron-icons.html" />
        <link rel="import"
              href="/bower_components/iron-pages/iron-pages.html" />
        <link rel="import"
              href="/bower_components/iron-ajax/iron-ajax.html" />
        <link rel="import"
              href="/bower_components/iron-selector/iron-selector.html" />
        <!-- Paper elements -->
        <link rel="import"
              href="/bower_components/paper-drawer-panel/paper-drawer-panel.html" />
        <link rel="import"
              href="/bower_components/paper-icon-button/paper-icon-button.html" />
        <link rel="import"
              href="/bower_components/paper-item/paper-item.html" />
        <link rel="import"
              href="/bower_components/paper-card/paper-card.html" />
        <link rel="import"
              href="/bower_components/paper-material/paper-material.html" />
        <link rel="import"
              href="/bower_components/paper-menu/paper-menu.html" />
        <link rel="import"
              href="/bower_components/paper-menu/paper-submenu.html" />
        <link rel="import"
              href="/bower_components/paper-scroll-header-panel/paper-scroll-header-panel.html" />
        <link rel="import"
              href="/bower_components/paper-styles/paper-styles-classes.html" />
        <link rel="import"
              href="/bower_components/paper-toast/paper-toast.html" />
        <link rel="import"
              href="/bower_components/paper-toolbar/paper-toolbar.html" />
        <link rel="import"
              href="/bower_components/paper-dialog/paper-dialog.html" />
        <link rel="import"
              href="/bower_components/paper-dialog-scrollable/paper-dialog-scrollable.html" />
        <link rel="import"
              href="/bower_components/paper-button/paper-button.html" />
        <link rel="import"
              href="/bower_components/paper-header-panel/paper-header-panel.html" />
        <link rel="import"
              href="/bower_components/paper-styles/color.html" />
        <link rel="import"
              href="/bower_components/paper-tabs/paper-tabs.html" />
        <link rel="import"
              href="/bower_components/paper-tabs/paper-tab.html" />
        <link rel="import"
              href="/bower_components/paper-radio-button/paper-radio-button.html" />
        <link rel="import"
              href="/bower_components/paper-radio-group/paper-radio-group.html" />
        <!-- 
        Add our elements here 
        -->
        <link rel="import"
              href="/styles/app-theme.html" />
        <link rel="import"
              href="/styles/shared-styles.html" />
        <link rel="import"
              href="/elements/main-tabs/main-tabs.html" />
        <link rel="stylesheet"
              th:href="@{${meta64Css}}" />
        <script th:inline="javascript">/* 
<![CDATA[*/
        /*
        Old browsers may not have the console.log/console.error functions.
        */
        if (!window.console) {
                console = {
                        log : function() {
                        },
                        error : function() {
                        }
                };
        }
        
        window.onerror = function(message, url, line, col, err) {
                var msg = "ERROR: " + message + " [url:" + url + "] line " + line + " col: " + col;
                if (err.stack) {
                        msg += " err: " + err.stack;
                }
                console.log(msg);
        }
        
        var cookiePrefix = /*[[${@constantsProvider.getCookiePrefix()}]]*/"";
        var BRANDING_TITLE = /*[[${@constantsProvider.getBrandingTitle()}]]*/"";
        var cacheVersion = /*[[${@constantsProvider.getCacheVersion()}]]*/"";
        var profileName = /*[[${@constantsProvider.getProfileName()}]]*/"";
        
        console.log("cacheVersion: " + cacheVersion);
        
        /**
         * IMPORTANT: "Same Origin Policy" is very very strict on the precise text of the name even if
         * it maps in DNS to same thing it must be a text match and may different to browser.
         */
         var postTargetUrl = window.location.origin + "/mobile/api/";
         /*]]>
*/</script>
        <script type="text/javascript"
                th:src="@{${jqueryJs}}"></script>
        <!-- script type="text/javascript" th:src="@{${jqueryMobileJs}}"></script -->
        <script type="text/javascript"
                th:src="@{/js/cookie/jquery.cookie.js?ver.md=1}"></script>
        <script type="text/javascript"
                th:inline="javascript"
                th:src="@{${scriptLoaderJs}}"></script>
    </head>
    <body unresolved="unresolved"
          class="fullbleed layout vertical">
        <span id="browser-sync-binding"></span>
        <dom-module is="main-dom-module">
            <!--  link rel="import" type="css" href="/css/meta64.css"/ -->
            <template is="dom-bind"
                      id="app">
                <style is="custom-style"
                       include="shared-styles"></style>
                <iron-ajax id="ironAjax"></iron-ajax>
                <paper-drawer-panel id="paperDrawerPanel">
                    <!-- Left Side Panel -->
                    <paper-scroll-header-panel drawer="drawer"
                                               fixed="fixed">
                        <!--
                        commenting until I learn to style this in polymer                        
                        <paper-toolbar id="drawerToolbar">
                            <span class="paper-font-title">Menu</span>
                        </paper-toolbar>
                        -->
                        <div class="horizontal-section">
                            <paper-menu id="mainNavBar"
                                        attr-for-item-title="label"
                                        multi="multi"></paper-menu>
                        </div>
                    </paper-scroll-header-panel>
                    <!-- Main Area -->
                    <paper-header-panel main="main"
                                        id="headerPanelMain">
                        <!-- 
                        Main App Header (Colored region at top RHS)
                        -->
                        <paper-toolbar id="mainToolbar">
                            <div id="headerAppName"
                                 class="app-name">Meta64</div>
                            <!-- 
                            <div class="bottom bottom-container center horizontal layout">
                                <div id="mainSubHeading" class="bottom-title paper-font-subhead">A new kind of Semantic Web</div>
                            </div>
                            -->
                        </paper-toolbar>
                        <!-- 
                        Main Content (Tabs on RHS, which hold all content, except popup dialogs)
                        -->
                        <main-tabs />
                    </paper-header-panel>
                </paper-drawer-panel>
            </template>
        </dom-module>
        <script src="scripts/app.js"></script>
        <script>/* 
<![CDATA[*/  
        console.log("Loading scripts.");
        
        $(window).load(function() {
        
        //We load scripts from 'min' (minimized) single file for production, or each individual file
        //if not in production.
        
        var scripts = (profileName === 'prod') ? [ "/js/meta64.min.js" ] : //
        [ //
        "/js/meta64/cnst.js",//
        "/js/meta64/jcrCnst.js",//
        "/js/meta64/attachment.js", //
        "/js/meta64/edit.js", //
        "/js/meta64/meta64.js", //
        "/js/meta64/nav.js", //
        "/js/meta64/prefs.js", //
        "/js/meta64/props.js", //
        "/js/meta64/render.js", //
        "/js/meta64/search.js", //
        "/js/meta64/share.js", //
        "/js/meta64/user.js", //
        "/js/meta64/util.js", //
        "/js/meta64/view.js", //
        "/js/meta64/pg/popupMenuPg.js",//
        "/js/meta64/pg/confirmPg.js",//
        "/js/meta64/pg/messagePg.js",//
        "/js/meta64/pg/searchResultsPg.js",//
        "/js/meta64/pg/loginPg.js",//
        "/js/meta64/pg/signupPg.js",//
        "/js/meta64/pg/prefsPg.js",//
        "/js/meta64/pg/exportPg.js",//
        "/js/meta64/pg/importPg.js",//
        "/js/meta64/pg/searchPg.js",//
        "/js/meta64/pg/changePasswordPg.js",//
        "/js/meta64/pg/uploadPg.js",//
        "/js/meta64/pg/editNodePg.js",//
        "/js/meta64/pg/editPropertyPg.js",//
        "/js/meta64/pg/shareToPersonPg.js",//,
        "/js/meta64/pg/sharingPg.js", //
        "/js/meta64/pg/renameNodePg.js", //
        "/js/meta64/pg/timelinePg.js" //
        ];
        /*
        Loads all JS files, and then calls initApp once they are all completely loaded
        */
        loader.loadScripts(scripts, //
                function() {
                
                                /*
                                http://stackoverflow.com/questions/33265769/polymer-1-0-on-firefox-referenceerror-polymer-is-not-defined
                                */
                                addEventListener('WebComponentsReady', function() {
                        meta64.initApp();
                                });
                });
        });
/*]]>
*/</script>
    </body>
</html>
